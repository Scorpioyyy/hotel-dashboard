# Feature Specification: 花园酒店评论分析系统

**Feature Branch**: `001-review-dashboard`
**Created**: 2026-01-14
**Status**: Draft
**Input**: User description: "基于需求文档构建酒店评论数据可视化看板和智能问答系统"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 数据可视化看板 (Priority: P1)

作为酒店运营管理人员，我希望能够通过可视化图表快速了解酒店评论数据的整体分布情况，以便识别酒店服务的优势和改进空间。

**Why this priority**: 数据可视化是系统的核心功能，为业务决策提供直观的数据支撑。没有看板，用户无法获得任何数据洞察。

**Independent Test**: 可通过访问看板页面、查看各维度图表是否正确渲染并展示真实数据来独立测试。

**Acceptance Scenarios**:

1. **Given** 系统已导入评论数据, **When** 用户访问看板首页, **Then** 用户看到包含评分分布、时间趋势、房型分析、旅行类型、评论类别、质量分布、用户活跃度的图表展示
2. **Given** 用户在看板页面, **When** 用户选择特定时间范围或筛选条件, **Then** 所有相关图表联动更新显示筛选后的数据
3. **Given** 图表数据加载中, **When** 数据正在获取, **Then** 用户看到加载状态指示
4. **Given** 用户使用移动设备访问, **When** 查看看板, **Then** 图表自适应屏幕大小并保持可读性

---

### User Story 2 - 评论详情浏览 (Priority: P2)

作为酒店运营管理人员，我希望能够查看具体的评论内容和配图，以便深入了解顾客的真实反馈。

**Why this priority**: 数据图表提供宏观视角，但具体评论内容能提供详细的改进线索。此功能依赖于数据导入但可独立于问答功能测试。

**Independent Test**: 可通过访问评论列表页面、验证评论内容和图片是否正确显示来独立测试。

**Acceptance Scenarios**:

1. **Given** 系统已导入评论数据, **When** 用户访问评论列表, **Then** 用户看到评论的文本内容、配图、评分、发布日期、房型等信息
2. **Given** 用户在评论列表页面, **When** 用户按评分/房型/旅行类型/类别进行筛选, **Then** 列表仅显示符合条件的评论
3. **Given** 用户希望查看高质量评论, **When** 用户启用高质量推荐筛选, **Then** 系统展示质量分较高的评论
4. **Given** 评论包含配图, **When** 用户点击图片, **Then** 用户可以查看大图

---

### User Story 3 - 智能问答服务 (Priority: P3)

作为酒店运营管理人员，我希望能够用自然语言提问，获得基于真实评论数据的回答，以便快速获取特定问题的洞察。

**Why this priority**: 智能问答是高级功能，依赖于数据导入和检索基础设施。可以在核心看板和评论浏览功能完成后独立开发。

**Independent Test**: 可通过输入问题、验证系统返回基于真实评论的回答和引用来源来独立测试。

**Acceptance Scenarios**:

1. **Given** 系统已导入评论数据, **When** 用户输入自然语言问题（如"顾客对早餐的评价如何"）, **Then** 系统展示基于相关评论生成的回答
2. **Given** 系统生成回答, **When** 回答展示完成, **Then** 同时展示作为回答依据的原始评论
3. **Given** 用户提问的内容在评论数据中无相关信息, **When** 系统无法找到相关评论, **Then** 系统明确告知用户当前无相关数据，而非编造回答
4. **Given** 用户等待回答, **When** AI 正在处理, **Then** 用户看到加载状态指示

---

### Edge Cases

- 当评论数据为空或导入失败时，系统显示友好的提示信息并引导用户检查数据源
- 当评论的 category1/2/3 字段值不在14个标准小类中时，系统在前端聚合时自动过滤
- 当评论配图 URL 失效时，系统显示占位图或友好提示
- 当 AI 问答服务正在生成回答时，用户可以终止回答并重新提问
- 当用户在 AI 回答生成过程中切换页面时，系统继续在后台生成回答并保存到 sessionStorage
- 当用户返回问答页面时，系统从 sessionStorage 恢复对话历史和正在生成的回答
- 当评论内容过长时，系统应正确处理滚动和分页显示
- 当用户提问的内容无法在评论数据中找到相关信息时，系统明确告知而非生成虚假回答

## Requirements *(mandatory)*

### Functional Requirements

**数据导入与处理**
- **FR-001**: 系统必须能够导入 `enriched_comments.csv` 文件中的评论数据
- **FR-002**: 系统必须将 `categories` 数组拆分为 `category1`、`category2`、`category3` 三个独立字段存储
- **FR-003**: 系统必须新增 `star` 字段，将 `score` 浮点数转换为 1-5 的整数星级
- **FR-004**: 系统必须保留原始 `score` 浮点数字段（0.5-5.0）用于精确计算
- **FR-005**: 系统必须使用 `fuzzy_room_type` 字段进行房型分类

**数据可视化**
- **FR-006**: 系统必须展示评分分布统计图表（基于 star 字段）
- **FR-007**: 系统必须展示时间趋势分析图表（按 publish_date 月度聚合）
- **FR-008**: 系统必须展示房型分析图表（基于 fuzzy_room_type）
- **FR-009**: 系统必须展示旅行类型分布图表
- **FR-010**: 系统必须展示评论类别分布图表（聚合 category1/2/3 三个字段）
- **FR-011**: 系统必须支持图表点击跳转到评论列表页，并自动应用对应筛选条件
- **FR-012**: 数据看板位于 `/dashboard` 路由

**评论展示**
- **FR-013**: 评论浏览页位于首页路由 `/`
- **FR-014**: 系统必须展示评论文本内容和配图
- **FR-015**: 系统必须支持按星级（star）、房型（fuzzy_room_type）、旅行类型、类别筛选评论
- **FR-016**: 系统必须支持高质量评论推荐（quality_score ≥ 8 分）
- **FR-017**: 系统必须支持关键词搜索评论内容
- **FR-018**: 系统必须支持多种排序方式（最新发布、最早发布、评分最高、评分最低、质量最高、点赞最多、回复最多）
- **FR-019**: 系统必须使用分页展示评论列表

**智能问答**
- **FR-020**: 智能问答页位于 `/qa` 路由
- **FR-021**: 系统必须支持用户输入自然语言问题
- **FR-022**: 系统必须基于问题关键词提取相关类别，检索高质量评论（quality_score ≥ 8）
- **FR-023**: 系统必须使用 Gemini 3 Flash Preview 模型基于召回的评论生成回答
- **FR-024**: 系统必须支持流式响应，实时显示 AI 回答内容
- **FR-025**: 系统必须支持后台流式服务，允许用户在 AI 回答生成过程中切换页面
- **FR-026**: 系统必须在回答完成后展示作为依据的原始评论（最多10条）
- **FR-027**: 当无相关评论数据时，系统必须明确告知用户而非生成无依据回答
- **FR-028**: 系统必须支持终止正在生成的回答
- **FR-029**: 系统必须使用 sessionStorage 保存对话历史，页面刷新后可恢复

**用户体验**
- **FR-030**: 系统全部界面必须使用中文
- **FR-031**: 系统必须支持响应式设计，适配桌面端和移动端
- **FR-032**: 系统必须在数据加载时显示加载状态
- **FR-033**: 系统必须在操作失败时显示友好的错误提示

### Key Entities

- **评论 (Comment)**: 核心数据实体，包含评论文本、配图、评分、发布日期、房型、旅行类型、质量分、类别标签等属性
- **评论类别 (Category)**: 评论的分类标签，分为5大类14小类，用于评论内容的多维度分析
- **问答会话 (QA Session)**: 用户问题与系统回答的交互记录，包含问题文本、AI 回答、引用的评论列表。会话不持久化存储，每次访问为独立会话

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户能够在3秒内完成看板页面的首次加载并看到所有图表
- **SC-002**: 用户能够在5秒内获得智能问答的回答结果
- **SC-003**: 用户筛选操作后，图表能够在1秒内完成联动更新
- **SC-004**: 用户能够在移动设备上正常浏览所有功能，无需横向滚动
- **SC-005**: 系统展示的类别分布数据100%符合14个标准小类定义
- **SC-006**: AI 回答100%附带原始评论引用来源
- **SC-007**: 用户能够通过最多3次点击完成任意筛选条件的组合设置

## Clarifications

### Session 2026-01-14

- Q: 用户的问答历史是否需要持久化存储？ → A: 不保存，每次会话独立
- Q: quality_score 达到多少分以上算"高质量评论"？ → A: ≥8 分
- Q: 智能问答应展示多少条引用评论？ → A: 3-5 条，根据相关性排序

## Assumptions

- 评论数据已预先清洗，质量分 ≤ 4 分的低质量评论已被剔除
- Insforge 数据库已通过 MCP 配置完成，可直接调用
- Gemini 3 Flash Preview 模型接口可用且稳定
- 用户具备基本的数据分析需求理解能力
- 评论数据量在合理范围内，不会超出系统承载能力
